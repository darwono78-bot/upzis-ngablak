<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Input & Laporan KOIN NU Interaktif</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f8f9fa; }
        h1, h2 { color: #006400; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 40px; background-color: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #006400; color: white; text-align: center; }
        .text-right { text-align: right; }
        .footer-total { background-color: #e6ffe6; font-weight: bold; }
        .header-group { background-color: #006400; color: white; }
        input[type="number"] { width: 90%; padding: 4px; border: 1px solid #ccc; text-align: right; }
        .input-table th { background-color: #007bff; }
    </style>
</head>
<body>

    <h1>Sistem Input & Laporan KOIN NU Interaktif</h1>
    <p style="color: red; font-weight: bold;">Catatan: Silakan ubah angka di Modul 1, maka Modul 2 dan 3 akan otomatis berubah.</p>

    <h2>MODUL 1: INPUT DATA BULANAN (Sumber Utama)</h2>
    <table id="tabel-modul-1" class="input-table">
        <thead>
            <tr>
                <th rowspan="2">BULAN</th>
                <th rowspan="2">TOTAL PENERIMAAN KOIN (100%)</th>
                <th colspan="4">PENGELUARAN (Contoh Kolom Kunci)</th>
            </tr>
            <tr>
                <th>Honor Wajib (Persentase 40%)</th>
                <th>Pendidikan</th>
                <th>Kesehatan</th>
                <th>Sosial & Lain-lain</th>
            </tr>
        </thead>
        <tbody id="m1-input-body">
            </tbody>
    </table>

    <hr>

    <h2>MODUL 2: TAMPILAN JURNAL UMUM (Bulan Januari)</h2>
    <p>Dana Masuk Koin di Jurnal Umum adalah 100% dari total Penerimaan Koin bulan Januari.</p>
    <table id="tabel-modul-2">
        <thead>
            <tr>
                <th>NO</th>
                <th>KETERANGAN</th>
                <th>DANA MASUK (DEBIT)</th>
                <th>DANA KELUAR (KREDIT)</th>
                <th>SALDO</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>-</td><td>Saldo Bulan Lalu</td><td class="text-right">0</td><td class="text-right">0</td><td id="m2-saldo-awal" class="text-right">0</td></tr>
            <tr><td>1</td><td style="font-weight: bold;">Penerimaan Dana KOIN NU (100% Total)</td><td id="m2-dana-masuk-koin" class="text-right">0</td><td class="text-right">0</td><td id="m2-saldo-penerimaan" class="text-right">0</td></tr>
            <tr><td>2</td><td>Pengeluaran Honor Wajib (40%)</td><td class="text-right">0</td><td id="m2-dana-keluar-honor" class="text-right">0</td><td id="m2-saldo-honor" class="text-right">0</td></tr>
            <tr><td>3</td><td>Bantuan Sosial/Lain-lain</td><td class="text-right">0</td><td id="m2-dana-keluar-sosial" class="text-right">0</td><td id="m2-saldo-akhir" class="text-right">0</td></tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="2" class="footer-total text-right">TOTAL</td>
                <td id="m2-total-masuk" class="footer-total text-right">0</td>
                <td id="m2-total-keluar" class="footer-total text-right">0</td>
                <td class="footer-total text-right">-</td>
            </tr>
        </tfoot>
    </table>

    <hr>

    <h2>MODUL 3: TAMPILAN LAPORAN TAHUNAN</h2>
    <table id="tabel-modul-3">
        <thead>
            <tr>
                <th rowspan="2">NO</th>
                <th rowspan="2">BULAN</th>
                <th colspan="2">PENERIMAAN</th>
                <th colspan="5">PENGELUARAN WAJIB & SOSIAL</th>
                <th rowspan="2">JML PENGELUARAN (7)</th>
                <th rowspan="2">SALDO AKHIR BULAN INI (8)</th>
                <th rowspan="2">SALDO KAS TAHUN BERJALAN (9)</th>
            </tr>
            <tr>
                <th>Total Penerimaan Koin (3)</th>
                <th>Jml Donatur (4)</th>
                <th>Pendidikan</th>
                <th>Kesehatan</th>
                <th>Ekonomi</th>
                <th>Honor Wajib (40%)</th>
                <th>Sosial & Lain</th>
            </tr>
        </thead>
        <tbody id="m3-data-body">
            </tbody>
        <tfoot>
            <tr>
                <td colspan="2" class="footer-total text-right">TOTAL TAHUNAN</td>
                <td class="footer-total text-right" id="m3-total-penerimaan">0</td>
                <td class="footer-total text-right" id="m3-total-donatur">0</td>
                <td class="footer-total text-right" id="m3-total-pend-uang">0</td>
                <td class="footer-total text-right" id="m3-total-kes-uang">0</td>
                <td class="footer-total text-right" id="m3-total-eko-uang">0</td>
                <td class="footer-total text-right" id="m3-total-honor">0</td>
                <td class="footer-total text-right" id="m3-total-sosial">0</td>
                <td class="footer-total text-right" id="m3-total-pengeluaran">0</td>
                <td class="footer-total text-right" id="m3-footer-saldo-akhir">0</td>
                <td class="footer-total text-right" id="m3-footer-saldo-kas">0</td>
            </tr>
        </tfoot>
    </table>

    <script>
        // --- DATA INITIATION (digunakan untuk mengisi input awal) ---
        const INITIAL_DATA_SOURCE = [
            { bulan: 'Januari', penerimaan: 4000000, donatur: 200, pendUang: 0, kesUang: 0, ekoUang: 0, sosialLain: 1000000, honorWajibPercent: 0.40 },
            { bulan: 'Februari', penerimaan: 5000000, donatur: 250, pendUang: 500000, kesUang: 0, ekoUang: 0, sosialLain: 0, honorWajibPercent: 0.40 },
            { bulan: 'Maret', penerimaan: 6000000, donatur: 300, pendUang: 500000, kesUang: 500000, ekoUang: 0, sosialLain: 500000, honorWajibPercent: 0.40 },
            { bulan: 'April', penerimaan: 3000000, donatur: 150, pendUang: 0, kesUang: 0, ekoUang: 0, sosialLain: 0, honorWajibPercent: 0.40 },
            { bulan: 'Mei', penerimaan: 7000000, donatur: 350, pendUang: 1000000, kesUang: 0, ekoUang: 0, sosialLain: 500000, honorWajibPercent: 0.40 },
        ];

        // --- HELPER FUNCTION ---
        const formatNominal = (angka) => {
            if (typeof angka !== 'number' || isNaN(angka)) return '0';
            return angka.toLocaleString('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        };
        const parseInput = (id) => parseFloat(document.getElementById(id).value) || 0;

        // --- CORE FUNCTION 1: GATHER DATA FROM INPUTS ---
        function gatherInputData() {
            const data = [];
            INITIAL_DATA_SOURCE.forEach((monthData, index) => {
                const prefix = `m1-${index}-`;
                data.push({
                    bulan: monthData.bulan,
                    // Diambil dari input
                    penerimaan: parseInput(prefix + 'penerimaan'),
                    donatur: parseInput(prefix + 'donatur'),
                    pendUang: parseInput(prefix + 'pendidikan'),
                    kesUang: parseInput(prefix + 'kesehatan'),
                    ekoUang: parseInput(prefix + 'ekonomi'),
                    sosialLain: parseInput(prefix + 'sosial'),
                    // Honor wajib diambil dari konstanta 0.40
                    honorWajibPercent: monthData.honorWajibPercent 
                });
            });
            return data;
        }

        // --- CORE FUNCTION 2: UPDATE MODUL 2 (JURNAL UMUM) ---
        function updateJurnalUmum(data) {
            // Hanya menggunakan data bulan Januari (index 0)
            if (data.length === 0) return;
            const dataJan = data[0];
            const totalPenerimaan = dataJan.penerimaan; 
            const honorWajib = totalPenerimaan * dataJan.honorWajibPercent; 
            // Total Pengeluaran Sosial di Jurnal Umum diambil dari kolom 'Sosial & Lain-lain'
            const pengeluaranSosial = dataJan.sosialLain; 

            // Logika Jurnal Umum
            let saldoJurnalUmum = 0;
            let totalMasuk = 0;
            let totalKeluar = 0;

            document.getElementById('m2-saldo-awal').textContent = formatNominal(saldoJurnalUmum);

            // Penerimaan Dana KOIN NU (100%)
            saldoJurnalUmum += totalPenerimaan;
            totalMasuk += totalPenerimaan;
            document.getElementById('m2-dana-masuk-koin').textContent = formatNominal(totalPenerimaan);
            document.getElementById('m2-saldo-penerimaan').textContent = formatNominal(saldoJurnalUmum);

            // Pengeluaran Honor Wajib (40%)
            saldoJurnalUmum -= honorWajib;
            totalKeluar += honorWajib;
            document.getElementById('m2-dana-keluar-honor').textContent = formatNominal(honorWajib);
            document.getElementById('m2-saldo-honor').textContent = formatNominal(saldoJurnalUmum);
            
            // Bantuan Sosial/Lain-lain
            saldoJurnalUmum -= pengeluaranSosial;
            totalKeluar += pengeluaranSosial;
            document.getElementById('m2-dana-keluar-sosial').textContent = formatNominal(pengeluaranSosial);
            document.getElementById('m2-saldo-akhir').textContent = formatNominal(saldoJurnalUmum);

            // FOOTER MODUL 2
            document.getElementById('m2-total-masuk').textContent = formatNominal(totalMasuk);
            document.getElementById('m2-total-keluar').textContent = formatNominal(totalKeluar);
        }

        // --- CORE FUNCTION 3: UPDATE MODUL 3 (LAPORAN TAHUNAN) ---
        function updateLaporanTahunan(data) {
            const tableBody = document.getElementById('m3-data-body');
            tableBody.innerHTML = ''; 

            let totalPenerimaanTahunan = 0;
            let totalDonaturTahunan = 0;
            let totalPengeluaranTahunan = 0;
            let totalHonorTahunan = 0;
            let totalSosialTahunan = 0;
            let totalPendUangTahunan = 0;
            let totalKesUangTahunan = 0;
            let totalEkoUangTahunan = 0;

            let saldoKasTahunBerjalan = 0; 

            data.forEach((dataBulan, index) => {
                const no = index + 1;
                const honorWajib = dataBulan.penerimaan * dataBulan.honorWajibPercent;
                
                // Total Pengeluaran Kolom 7
                const jmlPengeluaranBulanIni = honorWajib + dataBulan.pendUang + dataBulan.kesUang + dataBulan.ekoUang + dataBulan.sosialLain;
                
                // Perhitungan Saldo Akhir Bulan (8)
                const saldoAkhirBulanIni = dataBulan.penerimaan - jmlPengeluaranBulanIni;
                // Perhitungan Saldo Kas Tahun Berjalan (9)
                saldoKasTahunBerjalan += saldoAkhirBulanIni; 

                // Akumulasi Total Tahunan
                totalPenerimaanTahunan += dataBulan.penerimaan;
                totalDonaturTahunan += dataBulan.donatur;
                totalPengeluaranTahunan += jmlPengeluaranBulanIni;
                totalHonorTahunan += honorWajib;
                totalSosialTahunan += dataBulan.sosialLain;
                totalPendUangTahunan += dataBulan.pendUang;
                totalKesUangTahunan += dataBulan.kesUang;
                totalEkoUangTahunan += dataBulan.ekoUang;
                
                // --- Buat Baris Data ---
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${no}</td>
                    <td>${dataBulan.bulan.toUpperCase()}</td>
                    <td class="text-right">${formatNominal(dataBulan.penerimaan)}</td>
                    <td class="text-right">${formatNominal(dataBulan.donatur)}</td>
                    <td class="text-right">${formatNominal(dataBulan.pendUang)}</td>
                    <td class="text-right">${formatNominal(dataBulan.kesUang)}</td>
                    <td class="text-right">${formatNominal(dataBulan.ekoUang)}</td>
                    <td class="text-right">${formatNominal(honorWajib)}</td>
                    <td class="text-right">${formatNominal(dataBulan.sosialLain)}</td>
                    <td class="text-right">${formatNominal(jmlPengeluaranBulanIni)}</td>
                    <td class="text-right">${formatNominal(saldoAkhirBulanIni)}</td>
                    <td class="text-right">${formatNominal(saldoKasTahunBerjalan)}</td>
                `;
            });

            // --- Update FOOTER (TOTAL TAHUNAN) ---
            document.getElementById('m3-total-penerimaan').textContent = formatNominal(totalPenerimaanTahunan);
            document.getElementById('m3-total-donatur').textContent = formatNominal(totalDonaturTahunan);
            document.getElementById('m3-total-pengeluaran').textContent = formatNominal(totalPengeluaranTahunan);
            document.getElementById('m3-total-honor').textContent = formatNominal(totalHonorTahunan);
            document.getElementById('m3-total-sosial').textContent = formatNominal(totalSosialTahunan);
            document.getElementById('m3-total-pend-uang').textContent = formatNominal(totalPendUangTahunan);
            document.getElementById('m3-total-kes-uang').textContent = formatNominal(totalKesUangTahunan);
            document.getElementById('m3-total-eko-uang').textContent = formatNominal(totalEkoUangTahunan);

            
            // LOGIKA STANDAR AKUNTANSI: Footer Kolom (8) dan (9) = Saldo Akhir Kumulatif (Baris Terakhir)
            document.getElementById('m3-footer-saldo-akhir').textContent = formatNominal(saldoKasTahunBerjalan); 
            document.getElementById('m3-footer-saldo-kas').textContent = formatNominal(saldoKasTahunBerjalan); 
        }

        // --- MAIN CONTROL FUNCTION ---
        function recalculateAllReports() {
            const currentData = gatherInputData();
            updateJurnalUmum(currentData);
            updateLaporanTahunan(currentData);
        }

        // --- INITIALIZATION ---
        function initializeLaporan() {
            const inputBody = document.getElementById('m1-input-body');
            
            // 1. Generate Input Fields (Modul 1)
            INITIAL_DATA_SOURCE.forEach((data, index) => {
                const prefix = `m1-${index}-`;
                const row = inputBody.insertRow();
                row.innerHTML = `
                    <td>${data.bulan.toUpperCase()}</td>
                    <td><input type="number" id="${prefix}penerimaan" value="${data.penerimaan}" min="0"></td>
                    <td><input type="number" id="${prefix}honor_percent" value="${data.honorWajibPercent * 100}" disabled style="background-color: #eee;"></td>
                    <td><input type="number" id="${prefix}pendidikan" value="${data.pendUang}" min="0"></td>
                    <td><input type="number" id="${prefix}kesehatan" value="${data.kesUang}" min="0"></td>
                    <td><input type="number" id="${prefix}sosial" value="${data.sosialLain}" min="0"></td>
                `;
            });
            
            // 2. Attach Event Listeners to ALL input fields
            const inputs = document.querySelectorAll('#m1-input-body input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', recalculateAllReports);
            });

            // 3. Run initial calculation
            recalculateAllReports();
        }

        // Jalankan fungsi setelah dokumen dimuat
        document.addEventListener('DOMContentLoaded', initializeLaporan);
    </script>

</body>
</html>
