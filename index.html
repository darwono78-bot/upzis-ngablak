import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
    getFirestore, collection, addDoc, getDocs, doc, deleteDoc, query, orderBy
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import {
    getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

// 1. KONFIGURASI FIREBASE
const firebaseConfig = {
    apiKey: "YOUR_API_KEY", // GANTI DENGAN PUNYA KAKAK
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
};

// 2. INISIALISASI
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// 3. VARIABEL GLOBAL
const COL_KOIN = 'laporan_koin_nu';
let koinData = []; // Array untuk menyimpan data koin yang dimuat

// 4. ELEMEN DOM
const authStatus = document.getElementById('user-status');
const loginBtn = document.getElementById('login-button');
const logoutBtn = document.getElementById('logout-button');
const submitKoinBtn = document.getElementById('submit-koin');


// 5. PENANGANAN OTENTIKASI (HANYA UNTUK MENGIZINKAN WRITE/UPDATE)
onAuthStateChanged(auth, (user) => {
    if (user) {
        authStatus.textContent = `Admin (${user.email}) sudah Login`;
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        submitKoinBtn.disabled = false; // Izinkan tombol simpan
    } else {
        authStatus.textContent = 'Belum Login';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        submitKoinBtn.disabled = true; // Nonaktifkan tombol simpan
    }
});

// Fungsi Login (Definisi di Window agar bisa dipanggil HTML)
window.handleLogin = async function() {
    const email = prompt("Masukkan Email Admin:");
    const password = prompt("Masukkan Password Admin:");

    if (email && password) {
        try {
            await signInWithEmailAndPassword(auth, email, password);
            alert("Login Berhasil!");
        } catch (error) {
            alert("Login Gagal: " + error.message);
            console.error(error);
        }
    }
};

// Fungsi Logout (Definisi di Window agar bisa dipanggil HTML)
window.handleLogout = async function() {
    try {
        await signOut(auth);
        alert("Logout Berhasil!");
    } catch (error) {
        alert("Logout Gagal: " + error.message);
    }
};

// Hubungkan tombol HTML ke fungsi (karena kita pakai module)
loginBtn.onclick = window.handleLogin;
logoutBtn.onclick = window.handleLogout;
